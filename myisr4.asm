; Author - Maryanovsky Alla
; My own keyboard interrupt + test
; You may press a s, e, d buttons for move the star on the display
IDEAL
MODEL small
STACK 100h
DATASEG
kbdbuf   db 8 dup (0)
esc_key  db 0
filename db 'try2.bmp',0
filehandle dw ?
Header db 54 dup (0)
Palette db 256*4 dup (0)
ScrLine db 320 dup (0)
ErrorMsg db 'Error', 13, 10 ,'$'
map db 'map.bmp',0
victoryp db 'victory.bmp',0
gameover db 'gameover.bmp',0
gforce1 db 0
gforceF db 0,'r'
gforceY db 0,'r'
level1 db 0
menu db 'menu3.bmp',0
leveldirection db 'd'
levelplace dw (320*83)+281
reddoor2  dw (320*22)+270, (320*22)+271,(320*22)+272, (320*22)+273, (320*22)+274,(320*22)+275
          dw (320*23)+270, (320*23)+271,(320*23)+272, (320*23)+273, (320*23)+274,(320*23)+275 
          dw (320*24)+270, (320*24)+271,(320*24)+272, (320*24)+273, (320*24)+274,(320*24)+275
          dw (320*25)+270, (320*25)+271,(320*25)+272, (320*25)+273, (320*25)+274,(320*25)+275
          dw (320*26)+270, (320*26)+271,(320*26)+272, (320*26)+273, (320*26)+274,(320*26)+275
          dw (320*27)+270, (320*27)+271,(320*27)+272, (320*27)+273, (320*27)+274,(320*27)+275
          dw (320*28)+300, (320*28)+301,(320*28)+302, (320*28)+303, (320*28)+304,(320*28)+305

bluedoor1 dw (320*22)+300, (320*22)+301,(320*22)+302, (320*22)+303, (320*22)+304,(320*22)+305
          dw (320*23)+300, (320*23)+301,(320*23)+302, (320*23)+303, (320*23)+304,(320*23)+305 
          dw (320*24)+300, (320*24)+301,(320*24)+302, (320*24)+303, (320*24)+304,(320*24)+305
          dw (320*25)+300, (320*25)+301,(320*25)+302, (320*25)+303, (320*25)+304,(320*25)+305
          dw (320*26)+300, (320*26)+301,(320*26)+302, (320*26)+303, (320*26)+304,(320*26)+305
          dw (320*27)+300, (320*27)+301,(320*27)+302, (320*27)+303, (320*27)+304,(320*27)+305
          dw (320*28)+300, (320*28)+301,(320*28)+302, (320*28)+303, (320*28)+304,(320*28)+305

level   db 246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246
db 246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246
db 246,246,246,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,246,246,246
db 246,246,246,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,246,246,246
db 246,246,246,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,246,246,246
db 246,246,246,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,246,246,246
db 246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246
db 246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246,246

backgroundl1 db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0 


bluedimond  db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
            db 253,253,253,253,0  ,0  ,0  ,0  ,0  ,0  ,0  ,253,253,253,253
            db 253,253,253,0  ,254,254,244,244,244,217,217,0  ,253,253,253
            db 253,253,0  ,254,254,254,244,244,244,217,217,217,0  ,253,253
            db 253,253,0  ,254,255,254,244,244,244,244,217,217,0  ,253,253
            db 253,253,0  ,254,255,254,244,244,244,244,217,217,0  ,253,253
            db 253,253,0  ,254,254,244,244,244,244,244,217,217,0  ,253,253
            db 253,253,253,0  ,254,244,244,244,244,244,217,0  ,253,253,253
            db 253,253,253,253,0  ,254,244,244,244,244,0  ,253,253,253,253
            db 253,253,253,253,253,0  ,244,244,244,0  ,253,253,253,253,253
            db 253,253,253,253,253,253,0  ,244,0  ,253,253,253,253,253,253
            db 253,253,253,253,253,253,253,0  ,253,253,253,253,253,253,253
            db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
            db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
            db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253

reddimond   db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
            db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
            db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
            db 253,253,253,253,0  ,0  ,0  ,0  ,0  ,0  ,0  ,253,253,253,253
            db 253,253,253,0  ,87 ,15 ,15 ,15 ,14 ,1  ,1  ,0  ,253,253,253
            db 253,253,0  ,87 ,103,87 ,87 ,15 ,15 ,14 ,1  ,1  ,0  ,253,253
            db 253,253,0  ,15 ,103,15 ,14 ,14 ,14 ,14 ,13 ,1  ,0  ,253,253
            db 253,253,0  ,87 ,15 ,87 ,15 ,14 ,14 ,14 ,13 ,1  ,0  ,253,253
            db 253,253,253,0  ,87 ,87 ,15 ,14 ,14 ,14 ,1  ,0  ,253,253,253
            db 253,253,253,253,0  ,87 ,87 ,14 ,14 ,13 ,0  ,253,253,253,253
            db 253,253,253,253,253,0  ,15 ,15 ,14 ,0  ,253,253,253,253,253
            db 253,253,253,253,253,253,0  ,14 ,0  ,253,253,253,253,253,253
            db 253,253,253,253,253,253,253,0  ,253,253,253,253,253,253,253
            db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
            db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253

backgrounddw1   db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  

backgrounddw2   db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   

backgrounddw3   db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  

backgrounddw4   db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  

backgrounddf1  db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   

backgrounddf2   db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  

backgrounddf3   db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0   

backgrounddf4   db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  

cube    db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
        db 253,251,251,251,251,251,251,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,251,251,251,251,251,253
        db 253,251,251,251,251,251,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,251,251,251,251,251,253
        db 253,251,251,251,251,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,251,251,251,251,253
        db 253,251,251,251,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,251,251,251,253
        db 253,251,251,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,7  ,7  ,7  ,7  ,7  ,251,251,253
        db 253,253,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,7  ,7  ,7  ,7  ,7  ,7  ,7  ,253,253
        db 253,253,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,253,253
        db 253,253,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,253,253
        db 253,253,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,253,253
        db 253,253,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,7  ,245,7  ,253,253
        db 253,253,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,7  ,7  ,245,7  ,253,253
        db 253,253,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,7  ,7  ,245,245,7  ,253,253
        db 253,253,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,7  ,7  ,7  ,245,247,7  ,253,253
        db 253,253,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,245,7  ,7  ,245,247,245,7  ,253,253
        db 253,251,251,7  ,7  ,7  ,7  ,7  ,7  ,7  ,245,245,245,245,245,247,245,247,251,251,253
        db 253,251,251,251,7  ,7  ,7  ,7  ,245,245,245,245,245,247,247,247,247,251,251,251,253
        db 253,251,251,251,251,7  ,7  ,7  ,245,245,245,245,247,247,247,247,251,251,251,251,253
        db 253,251,251,251,251,251,7  ,7  ,7  ,7  ,7  ,245,247,247,247,251,251,251,251,251,253
        db 253,251,251,251,251,251,253,253,253,253,253,253,253,253,253,251,251,251,251,251,253
        db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253,253

cubebackground1 db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
                db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  

fireboy db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
        db 253,253,253,253,0  ,0  ,253,253,253,0  ,0  ,253,253,253,253
        db 253,253,253,253,0  ,79 ,0  ,0  ,0  ,79 ,0  ,0  ,253,253,253
        db 253,253,253,0  ,79 ,79 ,79 ,79 ,0  ,79 ,0  ,79 ,0  ,253,253
        db 253,0  ,0  ,79 ,79 ,79 ,79 ,79 ,0  ,79 ,0  ,0  ,79 ,0  ,253
        db 253,0  ,79 ,79 ,79 ,79 ,79 ,79 ,66 ,79 ,79 ,0  ,79 ,0  ,253
        db 253,0  ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,0  ,253
        db 253,0  ,79 ,251,251,251,79 ,79 ,79 ,251,251,251,79 ,0  ,253
        db 253,0  ,79 ,251,0  ,251,79 ,79 ,79 ,251,0  ,251,79 ,0  ,253
        db 253,0  ,79 ,251,251,251,79 ,79 ,79 ,251,251,251,79 ,0  ,253
        db 253,0  ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,0  ,253
        db 253,0  ,79 ,79 ,79 ,0  ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,0  ,253
        db 253,0  ,79 ,79 ,79 ,79 ,0  ,0  ,0  ,0  ,79 ,79 ,79 ,0  ,253
        db 253,253,0  ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,79 ,0  ,253,253
        db 253,253,253,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,253,253,253
        db 253,253,253,0  ,79 ,0  ,0  ,79 ,79 ,0  ,0  ,79 ,0  ,253,253
        db 253,253,0  ,79 ,0  ,253,0  ,79 ,79 ,0  ,253,0  ,79 ,0  ,253
        db 253,253,0  ,0  ,253,253,0  ,79 ,79 ,0  ,253,253,0  ,0  ,253
        db 253,253,253,253,253,253,0  ,0  ,0  ,0  ,253,253,253,253,253
        db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253

backgroundw db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0

backgroundf db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0    

watergirl   db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253
            db 253,253,253,253,253,0  ,0  ,0  ,253,253,253,253,253,253,253
            db 253,253,253,253,0  ,240,240,9  ,0  ,253,253,253,253,253,253
            db 253,253,253,0  ,240,240,0  ,0  ,9  ,0  ,0  ,253,253,253,253
            db 253,253,0  ,0  ,9  ,240,0  ,9  ,240,240,9  ,0  ,253,253,253
            db 253,0  ,9  ,9  ,9  ,0  ,0  ,9  ,240,240,9  ,9  ,0  ,253,253
            db 253,0  ,9  ,9  ,0  ,240,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,253
            db 253,0  ,0  ,0  ,9  ,9  ,240,240,240,9  ,9  ,240,240,0  ,253
            db 253,0  ,240,9  ,9  ,9  ,9  ,240,9  ,9  ,9  ,9  ,240,0  ,253
            db 253,0  ,240,9  ,9  ,0  ,9  ,240,9  ,0  ,9  ,9  ,240,0  ,253
            db 253,0  ,240,9  ,9  ,9  ,9  ,240,9  ,9  ,9  ,9  ,240,0  ,253
            db 253,0  ,240,240,240,240,240,240,240,0  ,240,240,240,0  ,253
            db 253,253,0  ,240,240,9  ,0  ,0  ,0  ,240,240,240,0  ,253,253
            db 253,253,0  ,240,240,240,240,240,9  ,240,240,0  ,253,253,253
            db 253,0  ,240,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,253,253,253,253
            db 253,0  ,0  ,198,0  ,240,240,240,240,240,0  ,253,253,253,253
            db 253,253,253,0  ,240,0  ,240,240,240,0  ,240,0  ,253,253,253
            db 253,253,0  ,240,0  ,0  ,240,0  ,240,0  ,0  ,240,0  ,253,253
            db 253,253,253,253,253,0  ,0  ,253,0  ,0  ,253,253,253,253,253
            db 253,253,253,253,253,253,253,253,253,253,253,253,253,253,253

reddoor     db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,16 ,16 ,16 ,16 ,16 ,16 ,17 ,17 ,0  
            db 0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  
            db 0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  
            db 0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  
            db 0  ,100,100,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,87 ,87 ,87 ,87 ,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,87 ,87 ,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,87 ,87 ,87 ,100,87 ,100,87 ,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,87 ,100,100,100,87 ,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,87 ,100,100,100,87 ,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,87 ,100,100,100,87 ,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,87 ,87 ,87 ,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 , 91 ,91,91,91


bluedoor    db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  
            db 0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  
            db 0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  
            db 0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  
            db 0  ,100,100,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,9  ,9  ,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,9  ,9  ,9  ,9  ,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,9  ,9  ,100,100,9  ,9  ,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,9  ,9  ,100,100,9  ,9  ,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,9  ,9  ,9  ,9  ,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,9  ,9  ,100,100,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,9  ,9  ,9  ,9  ,9  ,9  ,100,100,100,100,0  ,100,100,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,9  ,9  ,100,100,100,100,100,100,24 ,24 ,2  ,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,9  ,9  ,100,100,100,100,100,100,24 ,99 ,16 ,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,99 ,24 ,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,24 ,2  ,0  
            db 0  ,100,100,0  ,100,100,100,100,100,100,100,100,100,100,100,100,100,100,0  ,2  ,16 ,0  
            db 0  ,0  ,0  ,0  ,0  ,0  ,0  ,0  ,100,100,100,100,100,100,100,100,100,100,16 ,40 ,16 ,0  
            db 0  ,2  ,2  ,2  ,2  ,24 ,2  ,2  ,0  ,16 ,16 ,16 ,16 ,16 ,16 ,16 ,16 ,0  ,0  ,2  ,2  ,0  
            db 91,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 ,91 

;==========================================================
; kbdbuf - array of 4 numbers: index 0 - down, index 1 - left, index 2 - up, index 3 - right
 ; numbers value 1 - key pressed
;==========================================================
CODESEG

proc OpenFilemenu
; Open file
mov ah, 3Dh
xor al, al
mov dx, offset menu
int 21h
jc openerror4
mov [filehandle], ax
ret
openerror4 :
mov dx, offset ErrorMsg
mov ah, 9h
int 21h
ret
endp OpenFilemenu

proc OpenFile
; Open file
mov ah, 3Dh
xor al, al
mov dx, offset filename
int 21h
jc openerror
mov [filehandle], ax
ret
openerror :
mov dx, offset ErrorMsg
mov ah, 9h
int 21h
ret
endp OpenFile

proc OpenFilegameover
; Open file
mov ah, 3Dh
xor al, al
mov dx, offset gameover
int 21h
jc openerror3
mov [filehandle], ax
ret
openerror3 :
mov dx, offset ErrorMsg
mov ah, 9h
int 21h
ret
endp OpenFilegameover

proc ReadHeader
; Read BMP file header, 54 bytes
mov ah,3fh
mov bx, [filehandle]
mov cx,54
mov dx,offset Header
int 21h
ret
endp ReadHeader

proc ReadPalette
; Read BMP file color palette, 256 colors * 4 bytes (400h)
mov ah,3fh
mov cx,400h
mov dx,offset Palette
int 21h
ret
endp ReadPalette

proc CopyPal
; Copy the colors palette to the video memory
; The number of the first color should be sent to port 3C8h
; The palette is sent to port 3C9h
push bp
mov bp,sp
push si
push cx
push dx
push ax

;----------------------black box-------------------------
mov si,[bp+4]
mov cx,256
mov dx,3C8h
mov al,0
; Copy starting color to port 3C8h
out dx,al
; Copy palette itself to port 3C9h
inc dx
PalLoop:
; Note: Colors in a BMP file are saved as BGR values rather than RGB .
mov al,[si+2] ; Get red value .
shr al,2 ; Max. is 255, but video palette maximal
; value is 63. Therefore dividing by 4.
out dx,al ; Send it .
mov al,[si+1] ; Get green value .
shr al,2
out dx,al ; Send it .
mov al,[si] ; Get blue value .
shr al,2
out dx,al ; Send it .
add si,4 ; Point to next color .
; (There is a null chr. after every color.)
loop PalLoop
;----------------------black box-------------------------
pop ax
pop dx
pop cx
pop si
pop bp
ret 2
endp CopyPal

proc CopyBitmap
; BMP graphics are saved upside-down .
; Read the graphic line by line (200 lines in VGA format),
; displaying the lines from bottom to top.
mov ax, 0A000h
mov es, ax
mov cx,200
PrintBMPLoop :
push cx
; di = cx*320, point to the correct screen line
mov di,cx
shl cx,6
shl di,8
add di,cx
; Read one line
mov ah,3fh
mov cx,320
mov dx,offset ScrLine
int 21h
; Copy one line into video memory
cld ; Clear direction flag, for movsb
mov cx,320
mov si,offset ScrLine
rep movsb ; Copy line to the screen
 ;rep movsb is same as the following code :
 ;mov es:di, ds:si
 ;inc si
 ;inc di
 ;dec cx
 ;loop until cx=0
pop cx
loop PrintBMPLoop
mov dx, 5000
mov cx, 5000
out_loop:

in_loop:
    loop in_loop
    mov cx, 5000
    dec dx
    cmp dx, 0
    jnz out_loop
ret
endp CopyBitmap

proc CloseFile
mov ah,3Eh
mov bx, [filehandle]
int 21h
ret
endp CloseFile

proc delay
    push si
	push cx
	
	mov si, 0FFFH
odd:
    mov cx, 5H
odin:
    loop odin
	dec si
	jnz odd
	
	pop cx
	pop si
	ret
endp delay	

;---------------------
proc watergirl_right
;watergirl moving right
push bp
mov bp,sp
push si
push di
push ax
push dx
push cx
;----------------------black box-------------------------
mov di,[bp+4]            ;di
cmp si,3
jne outtr
mov al,[gforceY]
cmp al,0
jne nothingchange2
mov [gforceY+1],'r'
nothingchange2:
push di
push si
call borders
pop ax
cmp al,'r'
je outtr
mov ax,offset backgroundw            ;offset backgroundw
push ax
push di
call print_backgroundw
push di
call taking_bluedimonds
inc di
push dx
call redpool
pop dx
cmp dl,'e'
je outw1
push ax
push di
call backgroundw1
mov dx,offset watergirl            ;offset watergirl
push dx
push di
call print_watergirl
jmp outtr
outw1:
mov cx,'e'
mov [bp+6],cx
outtr:
mov [bp+4],di
;----------------------black box-------------------------
pop cx
pop dx
pop ax
pop di
pop si
pop bp
ret 
endp watergirl_right

;---------------------
proc fireboy_right
;fireboy moving right 
push bp
mov bp,sp
push si
push bx
push ax
push dx
push cx
;----------------------black box-------------------------
mov bx,[bp+4]             ;bx
cmp si,7
jne outtr1
mov al,[gforceF]
cmp al,0
jne nothingchange3
mov [gforcef+1],'r'
nothingchange3:
push bx
push si
call borders
pop ax
cmp al,'r'
je outtr1
mov ax,offset backgroundf             ;offset backgroundf
push ax
push bx
call print_backgroungf	
push bx
call taking_reddimonds
inc bx
push dx
call bluepool
pop dx
cmp dl,'e'
je exittb
push ax
push bx
call backgroundf1
mov dx,offset fireboy            ;offset fireboy
push dx
push bx
call print_fireboy
jmp outtr1
exittb:
mov cx,'e'
mov [bp+6],cx
outtr1:
mov [bp+4],bx
;----------------------black box-------------------------
pop cx
pop dx
pop ax
pop bx
pop si
pop bp
ret 
endp fireboy_right
;---------------------


proc bluepool
push bp
mov bp,sp
push bx
push ax

add bx,20*320
mov ah,[es:bx]
cmp ah,232
je change
cmp ah,250
je change
add bx,10
mov ah,[es:bx]
cmp ah,232
je change
cmp ah,250
jne outb 
change:
mov ax,'e'
mov [bp+4],ax

outb:
pop ax
pop bx
pop bp
ret 
endp bluepool

proc redpool
push bp
mov bp,sp
push di
push ax

add di,20*320
mov ah,[es:di]
cmp ah,249
je change1
cmp ah,250
je change1
add di,10
mov ah,[es:di]
cmp ah,249
je change1
cmp ah,250
jne outb1

change1:
mov ax,'e'
mov [bp+4],ax

outb1:
pop ax
pop di
pop bp
ret 
endp redpool

proc greenpool
push bp
mov bp,sp
push bx
push ax

mov bx,[bp+4]      ;bx/di
add bx,21*230
mov ah,[es:bx]
cmp ah,250
je change2
add bx,15
mov ah,[es:bx]
cmp ah,250
jne outb3
change2:
mov ax,'e'
mov [bp+6],ax

outb3:
pop ax
pop bx
pop bp
ret 2
endp greenpool

proc watergirl_up
push bp
mov bp,sp
push si
push di
push ax
push dx
push cx
;----------------------black box-------------------------
mov di,[bp+4]            ;di
cmp si,2
jne outtu
mov al,[gforcey]
cmp al,0
jne nothingchange
mov [gforcey],60
nothingchange:
push di
push si
call borders
pop ax
cmp al,'u'
je outw2
mov ax,offset backgroundw            ;offset backgroundw
push ax
push di
call print_backgroundw
push di
call taking_bluedimonds
sub di,320
push dx
call redpool
pop dx
cmp dl,'e'
je outw2
push ax
push di
call backgroundw1
mov dx,offset watergirl            ;offset watergirl
push dx
push di
call print_watergirl
jmp outtu
outw2:
mov cx,'e'
mov [bp+6],cx
outtu:
mov [bp+4],di
;----------------------black box-------------------------
pop cx
pop dx
pop ax
pop di
pop si
pop bp
ret 
endp watergirl_up
;---------------------

proc fireboy_up
push bp
mov bp,sp
push si
push bx
push ax
push dx
push cx
;----------------------black box-------------------------
mov bx,[bp+4]             ;bx
cmp si,6
jne outtr2
mov al,[gforcef]
cmp al,0
jne nothingchange1
mov [gforcef],40
nothingchange1:
push bx
push si
call borders
pop ax
cmp al,'u'
je outtr2
mov ax,offset backgroundf            ;offset backgroundf
push ax
push bx
call print_backgroungf	
push bx
call taking_reddimonds
sub bx,320
push dx
call bluepool
pop dx
cmp dl,'e'
je exittb1
push ax
push bx
call backgroundf1
mov dx,offset fireboy             ;offset fireboy
push dx
push bx
call print_fireboy
jmp outtr2
exittb1:
mov cx,'e'
mov [bp+6],cx
outtr2:
mov [bp+4],bx
;----------------------black box-------------------------
pop cx
pop dx
pop ax
pop bx
pop si
pop bp
ret 
endp fireboy_up
;---------------------

proc watergirl_left
push bp
mov bp,sp
push si
push di
push ax
push dx
push cx
;----------------------black box-------------------------
mov di,[bp+4]            ;di
cmp si,1
jne outtl
mov al,[gforcey]
cmp al,0
jne nothingchange4
mov [gforcey+1],'l'
nothingchange4:
push di
push si
call borders
pop ax
cmp al,'l'
je outtl
mov ax,offset backgroundw            ;offset backgroundw
push ax
push di
call print_backgroundw
push di
call taking_bluedimonds
dec di
push dx
call redpool
pop dx
cmp dl,'e'
je outw3
push ax
push di
call backgroundw1
mov dx,offset watergirl           ;offset watergirl
push dx
push di
call print_watergirl
jmp outtl
outw3:
mov cx,'e'
mov [bp+6],cx
outtl:
mov [bp+4],di
;----------------------black box-------------------------
pop cx
pop dx
pop ax
pop di
pop si
pop bp
ret 
endp watergirl_left
;---------------------

proc fireboy_left
push bp
mov bp,sp
push si
push bx
push ax
push dx
push cx
;----------------------black box-------------------------
mov bx,[bp+4]             ;bx
cmp si,5
jne outtl2
mov al,[gforcef]
cmp al,0
jne nothingchange5
mov [gforcef+1],'l'
nothingchange5:
push bx
push si
call borders
pop ax
cmp al,'l'
je outtl2
mov dx,offset fireboy             ;offset fireboy
mov ax,offset backgroundf            ;offset backgroundf
push ax
push bx
call print_backgroungf	
push bx
call taking_reddimonds
dec bx
push dx
call bluepool
pop dx
cmp dl,'e'
je exittb12
push ax
push bx
call backgroundf1
push dx
push bx
call print_fireboy
jmp outtl2
exittb12:
mov cx,'e'
mov [bp+6],cx
outtl2:
mov [bp+4],bx
;----------------------black box-------------------------
pop cx
pop dx
pop ax
pop bx
pop si
pop bp
ret 
endp fireboy_left

proc watergirl_down
push bp
mov bp,sp
push si
push di
push ax
push dx
push cx
;----------------------black box-------------------------
mov di,[bp+4]            ;di
mov si,0
push di
push si
call borders
pop ax
cmp al,'d'
je outtd
mov ax,offset backgroundw            ;offset backgroundw
push ax
push di
call print_backgroundw
push di
call taking_bluedimonds
add di,320
push dx
call redpool
pop dx
;push dx
;push di
;call greenpool
;pop dx
cmp dl,'e'
je outd3
push ax
push di
call backgroundw1
mov dx,offset watergirl           ;offset watergirl
push dx
push di
call print_watergirl
jmp outtd
;victory2:
;mov cx,'v'
;mov [bp+6],cx
;jmp outtd
outd3:
mov cx,'e'
mov [bp+6],cx
outtd:
mov [bp+4],di
;----------------------black box-------------------------
pop cx
pop dx
pop ax
pop di
pop si
pop bp
ret 
endp watergirl_down

proc fireboy_down
push bp
mov bp,sp
push si
push bx
push ax
push dx
push cx
;----------------------black box-------------------------
mov bx,[bp+4]             ;bx
mov si,4
push bx
push si
call borders
pop ax
cmp al,'d'
je outtd1
mov dx,offset fireboy             ;offset fireboy
mov ax,offset backgroundf            ;offset backgroundf
push ax
push bx
call print_backgroungf	
push bx
call taking_reddimonds
;push dx
;call enterdoor
;pop dx
;cmp dl,'v'
;je victory1
add bx,320
push dx
call bluepool
pop dx
cmp dl,'e'
je exittb3
push ax
push bx
call backgroundf1
push dx
push bx
call print_fireboy
jmp outtd1
;mov [bp+8],bx
;victory1:
;mov cx,'v'
;mov [bp+6],cx
;jmp outtd1
exittb3:
mov cx,'e'
mov [bp+6],cx
outtd1:
mov [bp+4],bx
;----------------------black box-------------------------
pop cx
pop dx
pop ax
pop bx
pop si
pop bp
ret
endp fireboy_down

proc backgroundf1
push bp
mov bp,sp
push bx
push cx
push ax
push si
;---------------black box-------------
    mov bx, [bp+4]      ;the fireboy adress
    mov si, [bp+6]      ;offset backgroundf
    mov cx, 20      ;the image width
    next_color:

        push cx
        push bx
        mov cx, 15
        draw_pixel:
            mov ah ,[es:bx]
            mov [si], ah
            inc bx
            inc si
            loop draw_pixel
        pop bx
        pop cx
        add bx, 320
        loop next_color

;---------------black box-------------
pop si
pop ax
pop cx
pop bx
pop bp 
ret 4
endp backgroundf1

proc backgroundw1
push bp
mov bp,sp
push di
push cx
push ax
push si
;---------------black box-------------
    mov di, [bp+4]      ;the watergirl adress on the screen 
    mov si, [bp+6]      ;offset backgroundw
    mov cx, 20      ;the image width
    next_color2:

        push cx
        push di
        mov cx, 15
        draw_pixel2:
            
            mov ah ,[es:di]
            mov [si], ah
            inc di
            inc si
            loop draw_pixel2
        pop di
        pop cx
        add di, 320
        loop next_color2

;---------------black box-------------
pop si
pop ax
pop cx
pop di
pop bp 
ret 4
endp backgroundw1

proc backgroundl
push bp
mov bp,sp
push bx
push cx
push ax
push si
;---------------black box-------------
    mov bx, [bp+4]      ;the level adress on the screen 
    mov si, [bp+6]      ;offset backgroundl
    mov cx, 29     ;the image width
    next_color14:

        push cx
        push bx
        mov cx, 35
        draw_pixel14:
            mov ah ,[es:bx]
            mov [si], ah
            inc bx
            inc si
            loop draw_pixel14
        pop bx
        pop cx
        add bx, 320
        loop next_color14

;---------------black box-------------
pop si
pop ax
pop cx
pop bx
pop bp 
ret 4
endp backgroundl

proc gforcefire
push bx
push ax
push si
push cx
;---------------black box-------------
mov cl,[gforcef]            ;speed
mov al,[gforcef+1]          ;direction
cmp cl,0
je outf
cmp cl,10
jle movedown2
fireup:
    push dx
    push bx
    call fireboy_up
    pop bx
    pop dx
    cmp al,'l'
    jne rightuf
    push dx
    push bx
    call fireboy_left
    pop bx
    pop dx
    jmp updatecl
    rightuf:
    push dx
    push bx
    call fireboy_right
    pop bx
    pop dx
    jmp updatecl
movedown2:
    push dx
    push bx
    call fireboy_down
    pop bx
    pop dx
    cmp al,'l'
    jne rightud
    push dx
    push bx
    call fireboy_left
    pop bx
    pop dx
    jmp updatecl
    rightud:
    push dx
    push bx
    call fireboy_right
    pop bx
    pop dx
updatecl:
    dec cl
    mov [gforcef],cl
;---------------black box-------------
outf:
pop cx
pop si
pop ax
pop bx
ret
endp gforcefire

proc gforcewater
push bp
mov bp,sp
push bx
push ax
push dx
push cx
push di
;---------------black box-------------
mov cl,[gforceY]            ;speed
mov al,[gforceY+1]          ;direction
cmp cl,0
je outf1
cmp cl,30
jl movedown1
waterup:
    mov si,2
    push dx
    push di
    call watergirl_up
    pop di
    pop dx
    jmp updatecl1
movedown1:
    push dx
    push di
    call watergirl_down
    pop di
    pop dx
updatecl1:
    dec cl
    mov [gforcey],cl
    mov [bp+4],di
;---------------black box-------------
outf1:
pop di
pop cx
pop dx
pop ax
pop bx
pop bp
ret
endp gforcewater

proc cubebackground
push bp
mov bp,sp
push di
push cx
push ax
push si
;---------------black box-------------
    mov di, [bp+4]      ;the cube adress on the screen 
    mov si, [bp+6]      ;offset backgroundw
    mov cx, 21      ;the image width
    next_color11:

        push cx
        push di
        mov cx, 21
        draw_pixel11: 
            
            mov ah ,[es:di]
            mov [si], ah
            inc di
            inc si
            loop draw_pixel11
        pop di
        pop cx
        add di, 320
        loop next_color11

;---------------black box-------------
pop si
pop ax
pop cx
pop di
pop bp 
ret 4
endp cubebackground

proc backgroundd             ;saved the background of the dimonds
push bp
mov bp,sp
push di
push cx
push ax
push si
;---------------black box-------------
    mov di, [bp+4]      ;the reddimond/bluedimond adress on the screen 
    mov si, [bp+6]      ;offset backgroundd
    mov cx, 15      ;the image width
    next_color7:

        push cx
        push di
        mov cx, 15
        draw_pixel7:
            
            mov ah ,[es:di]
            mov [si], ah
            inc di
            inc si
            loop draw_pixel7
        pop di
        pop cx
        add di, 320
        loop next_color7

;---------------black box-------------
pop si
pop ax
pop cx
pop di
pop bp 
ret 4
endp backgroundd

proc printbackgroundd
    push bp
    mov bp, sp
    push ax
    push bx
    push cx
    push dx
    push si
;-----------black_box----------------
    mov bx, [bp+4]      ;the backgroungf adress
    mov si, [bp+6]
    mov cx, 15      ;the image width
    next_color9:

        push cx
        push bx
        mov cx, 15
        draw_pixel9:
            mov ah, [si]
            mov [es:bx], ah  
            inc bx
            inc si
            loop draw_pixel9
        pop bx
        pop cx
        add bx, 320
        loop next_color9


;-----------black_box----------------
    pop si
    pop dx
    pop cx
    pop bx
    pop ax
    pop bp
    ret 4
endp printbackgroundd

proc taking_reddimonds
push bp
mov bp,sp
push bx
push ax
push dx
push si
push di
push cx

mov cx,15
mov bx,[bp+4]        ;bx/di fireboy/watergirl place on the screen 
mov ax, (320*178)+163
mov dx, (320*85)+60
mov si, (320*10)+90
mov di, (320*25)+150
add bx,7*320
checkk:
cmp bx,ax
je f1
cmp bx,dx
je f2
cmp bx,si
je f3
cmp bx,di
je f4
inc bx
add ax,320
add dx,320
add si,320
add di,320
loop checkk
jmp nottake1
f4:
push offset backgrounddf4
push (320*25)+150
call printbackgroundd
jmp nottake1
f1:
push offset backgrounddf1
push (320*178)+163
call printbackgroundd
jmp nottake1
f2:
push offset backgrounddf2
push (320*85)+60
call printbackgroundd
jmp nottake1
f3:
push offset backgrounddf3
push (320*10)+90
call printbackgroundd

nottake1:
pop cx
pop di
pop si
pop dx
pop ax
pop bx
pop bp
ret 2
endp taking_reddimonds

proc taking_bluedimonds
push bp
mov bp,sp
push di
push cx
push ax
push dx
push si
push bx
mov cx,15
mov di,[bp+4]        ;bx/di fireboy/watergirl place on the screen 
mov ax,(320*178)+230
mov dx,(320*93)+185
mov si,(320*31)+10
mov bx,(320*25)+180
add di,7*320
check:
cmp di,ax
je w1
cmp di,dx
je w2
cmp di,si
je w3
cmp di,bx
je w4
inc di
add ax,320
add dx,320
add si,320
add bx,320
loop check
jmp nottake
w4:
push offset backgrounddw4
push (320*25)+180
call printbackgroundd
jmp nottake
w1:
push offset backgrounddw1
push (320*178)+230
call printbackgroundd
jmp nottake
w2:
push offset backgrounddw2
push (320*93)+185
call printbackgroundd
jmp nottake
w3:
push offset backgrounddw3
push (320*31)+10
call printbackgroundd

nottake:
pop bx
pop si
pop dx
pop ax
pop cx
pop di
pop bp
ret 2
endp taking_bluedimonds

proc enterdoorFB
push bp
mov bp,sp
push bx
push di
push cx

mov cx,35
mov di,offset reddoor2
add bx,8
keepchacking:
    cmp bx,[di]
    je win
    inc di
    loop keepchacking
    jmp outk
win:
mov cx,'v'
mov [bp+4],cx

outk:
pop cx
pop di
pop bx
pop bp
ret
endp enterdoorFB

proc enterdoorWG
push bp
mov bp,sp
push di
push bx
push cx

mov cx,35
mov bx,offset bluedoor1
add di,8
keepchacking1:
    cmp di,[bx]
    je win1
    inc bx
    loop keepchacking1
    jmp outk1
win1:
mov cx,'v'
mov [bp+4],cx

outk1:
pop cx
pop bx
pop di
pop bp
ret
endp enterdoorWG

proc enterdoors
push bp
mov bp,sp
push ax
push dx
    push ax
    call enterdoorfb
    pop ax
    cmp ax,'v'
    jne outdo
    push dx
    call enterdoorWG
    pop dx
    cmp dx,'v'
    jne outdo
    mov [bp+4],dx
outdo:
pop dx
pop ax
pop bp
ret
endp enterdoors

proc gforce
push bp
mov bp,sp
push ax
push bx
push dx
push di
push cx
    mov cl,[gforce1]
    inc cl
    mov [gforce1],cl
    cmp cl,5
    jne toout
    mov cx,0
    mov [gforce1],cl
    
    push ax
    push bx
    call fireboy_down
    pop bx
    pop ax
    cmp ax,'e'
    je changee
    push dx
    push di
    call watergirl_down
    pop di
    pop dx
    cmp dx,'e'
    jne toout
changee:
mov [bp+4],ax
toout:
mov [bp+6],bx
mov [bp+8],di
pop cx
pop di
pop dx
pop bx
pop ax
pop bp
ret 
endp gforce

proc print_backgroungl
    push bp
    mov bp, sp
    push ax
    push bx
    push cx
    push dx
    push si
;-----------black_box----------------
    mov bx, 320*83+281     ;the backgroungl adress
    mov si, [bp+4]
    mov cx, 29    ;the image width
    next_color16:

        push cx
        push bx
        mov cx, 35
        draw_pixel16:
            mov ah, [si]
            mov [es:bx], ah 
            inc bx
            inc si
            loop draw_pixel16
        pop bx
        pop cx
        add bx, 320
        loop next_color16

;-----------black_box----------------
    pop si
    pop dx
    pop cx
    pop bx
    pop ax
    pop bp
    ret 2
ret 
endp print_backgroungl

proc levelup
push bp
mov bp,sp
push si
push bx
push ax
push dx
push cx
push di
;----------------------black box-------------------------
mov di,[bp+8]             ;bx,the location of fireboy on the screen 
mov ax,[bp+6]             ;level location
mov bx,[bp+4]             ;si, the location of the level on the scrren, leveldirection
mov dx,di
cmp al,'u'
jne outtu2
cmp bx,(320*83)+281
je changtod
mov si,offset backgroundl1            ;offset backgroundf
push si
call print_backgroungl
add dx,320*21
mov cx,35
push bx
checkl:
mov ah,[es:di]
cmp ah,246
je fireup1
inc di
loop checkl
jmp continuelu
fireup1:
push dx
push di
mov si,6
call fireboy_up
pop di
pop dx
push dx
push di
call fireboy_up
pop di
pop dx
continuelu:
pop bx
sub bx,320
mov dx,offset level             ;offset fireboy
push dx
push bx
call print_level
jmp outtu2
changtod:
mov al,'d'
outtu2:
mov [bp+6],bx
mov [bp+8],ax
;----------------------black box-------------------------
pop di
pop cx
pop dx
pop ax
pop bx
pop si
pop bp
ret 2
endp levelup

proc leveldown
push bp
mov bp,sp
push si
push bx
push ax
push dx
push cx
;----------------------black box-------------------------
mov ax,[bp+6]             ;levellocation 
mov bx,[bp+4]             ;levelplace
cmp al,'d'
jne outtd2
cmp bx,(320*104)+281
je updatetou
mov dx,offset level             ;offset level
mov si,offset backgroundl1            ;offset backgroundf
push si
call print_backgroungl	
add bx,320
push dx
push bx
call print_level
jmp outtd2
updatetou:
mov al,'u'
outtd2:
mov [bp+4],bx
mov [bp+6],ax
;----------------------black box-------------------------
pop cx
pop dx
pop ax
pop bx
pop si
pop bp
ret 
endp leveldown

proc movelevel
push bp
mov bp,sp
push si
push ax
push bx

    mov cl,[level1]
    inc cl
    cmp cl,5
    mov [level1],cl
    jne update
    mov cx,0
    mov [level1],cl

mov si,[bp+4]            ;levelplace
mov ax,[bp+6]            ;leveldirection
push bx
push ax
push si
call levelup
pop si
pop ax
push ax
push si
call leveldown
pop si
pop ax
update:
mov [bp+6],ax
mov [bp+4],si

pop bx
pop ax
pop si
pop bp
ret
endp movelevel

proc victorypic1
    call OpenFilevictory
    call ReadHeader
    call ReadPalette
    push offset palette
    call CopyPal
    call CopyBitmap
    call closefile
ret 
endp victorypic1

proc watergirlmove1
    push bp
    mov bp,sp
    push dx
    push di
;------------
    push dx
    push di
	call watergirl_right
    pop di
    pop dx
    
    push di
    push 10
    call borders
    pop ax
    cmp al,'d'
    jne notup
    push dx
    push di
    call watergirl_up
    pop di
    pop dx
notup:
    push dx
    push di
    call watergirl_left
    pop di
    pop dx
    mov [bp+4],di
    mov [bp+6],dx
    
    pop di
    pop dx
    pop bp
ret
endp watergirlmove1

proc fireboymove1
    push bp
    mov bp,sp
    push dx
    push di

    push dx
    push bx
    call fireboy_right
    pop bx
    pop dx
    push dx
    push bx
	call fireboy_up
    pop bx
    pop dx
    push dx
    push bx
    call fireboy_left
    pop bx
    pop dx
    mov [bp+6],dx
    mov [bp+4],bx

    pop di
    pop dx
    pop bp
ret 
endp fireboymove1
;======================================================================	
proc change_handler
    xor     ax, ax
    mov     es, ax

    cli                              ; interrupts disabled
    push    [word ptr es:9*4+2]      ; save old keyboard (9) ISR address - interrupt service routine(ISR)
    push    [word ptr es:9*4]
	                                 ; put my keyboard (9) ISR address: procedure irq1isr
    mov     [word ptr es:9*4], offset my_isr
	                                 ; put cs in ISR address
    mov     [es:9*4+2],        cs
    sti                               ; interrupts enabled

    call    my_program                     ; program that use the interrupt  lines 43 - 83

    cli                               ; interrupts disabled
    pop     [word ptr es:9*4]         ; restore ISR address
    pop     [word ptr es:9*4+2]
    sti                               ; interrupts enabled

    ret
endp change_handler	
;=====================================================================
proc my_program   
; main program
; moves the star
; 's' or downArrow - down, 'a' or leftArrow - left, 'w' or upArrow - up, 'd' or rightArrow - right
	mov ax, es                        ; save es
	push ax

	mov ax, 0a000h                    ; start address of text video memory
	                                  ; 80 columns * 25 rows * 2 bytes per character:
						              ; low byte = character code; high byte = attribute (background+color)
	mov es, ax
	
    push bp
    mov bp,sp

	mov bx, (320*178)+10             ; address on the middle of display, red star
	push offset fireboy
	push bx
	call print_fireboy 
	mov di, (320*150)+10            ; address on the middle of display, green star
	push offset watergirl
	push di
	call print_watergirl
    mov si, (320*178)+163          ;first red dimond's address 1
    push offset reddimond
    push si
    call printdimond
    mov si, (320*178)+230           ;first blue dimond's address 1
    push offset bluedimond
    push si
    call printdimond
    mov si, (320*85)+60             ;second red dimond's address 2
    push offset reddimond          
    push si
    call printdimond
    mov si, (320*93)+185            ;second blue dimond's address 2
    push offset bluedimond
    push si
    call printdimond
    mov si, (320*31)+10            ;third blue dimond's address 3
    push offset bluedimond
    push si
    call printdimond
    mov si, (320*10)+90          ;third red dimond's address 3
    push offset reddimond       
    push si
    call printdimond
    mov si, (320*25)+150         ;thorth red dimond's address 4
    push offset reddimond
    push si
    call printdimond
    mov si, (320*25)+180         ;thorth blue dimond's address 4
    push offset bluedimond      
    push si
    call printdimond
    mov si,(320*20)+292
    push offset bluedoor
    push si
    call print_doors
    mov si, (320*20)+262
    push offset reddoor
    push si
    call print_doors
    mov ax,(320*83)+281
    push offset level
    push ax
    call print_level
main_loop:                            ; none end loop: scan array kbdbuf
    mov si,0
	mov cx,8
check_buttons:
    cmp [byte ptr cs:esc_key], 0       ; if clicked ?
	jne toretttt                      ; yes ---> end the program
    mov al, [cs:kbdbuf + si]       ;scan array of clickes
	cmp al,0
	je cont
watergirlmove:
    push dx
    push di
    call watergirlmove1
    pop di
    pop dx
fireboymove:
    push bx
    push 10
    call borders
    pop ax
    cmp al,'d'
    jne cont 
    push dx
    push bx
    call fireboymove1
    pop bx
    pop dx
    cmp dx,'e'
    je e1
    jmp cont
toretttt:
    jmp toret
cont:	
	inc si
	loop check_buttons
    push di
    push bx
    push dx
    call gforce
    pop dx
    pop bx
    pop di
    cmp dx,'e'
    je e1
    call gforcefire
    push di
    call gforcewater
    pop di
    push dx
    call enterdoors
    pop dx
    cmp dx,'v'
    je victorypic 
    mov si,[levelplace]
    mov al,[leveldirection]
    push ax
    push si
    call movelevel
    pop si
    pop ax
    mov [levelplace],si
    mov [leveldirection],al
    call delay
    jmp main_loop
victorypic:
    mov [bp+12],dx
    call victorypic1
    jmp v
toret:
    mov dx,0
    mov [bp+12],dx
    e1:
    mov [bp+12],dx
    jmp v
    v:
    pop bp
    pop ax
	mov es, ax
    ret
endp my_program
;==============================================================

;==============================================================
proc my_isr               
 ; my isr for keyboard   
	push    ax
	push    bx
    push    cx
    push    dx
	push    di
	push    si
        

                        ; read keyboard scan code
    in      al, 60h

                        ; update keyboard state
    xor     bh, bh
    mov     bl, al
    and     bl, 7Fh     ; bx = scan code
	cmp bl, 11h         ; if click on w (index 1 in array kbdbuf)
	jne check1
	mov bl,2
	jmp end_check
	
check1:
	cmp bl, 1eh		    ; if click on a (index 0 in array kbdbuf)
	jne check2
	mov bl,1
	jmp end_check
	
check2:
	cmp bl, 20h		    ; if click on d (index 2 in array kbdbuf)
	jne check3
	mov bl,3
	jmp end_check
	
check3:
	cmp bl, 1fh		    ; if click on s (index 3 in array kbdbuf)
	jne check4
	mov bl,0
	jmp end_check
	
check4:
    cmp bl, 1h		    ; if click on esc
	jne check5
	mov [byte ptr cs:esc_key], 1

check5:
	cmp bx, 4Bh	    ; if click on leftarrow (index 3 in array kbdbuf)
	jne check6
	mov bl,5
	jmp end_check

check6:
	cmp bx, 50h	    ; if click on downarrow (index 3 in array kbdbuf)
	jne check7
	mov bl,4
	jmp end_check

check7:
	cmp bx, 4Dh	    ; if click on rightarrow (index 3 in array kbdbuf)
	jne check8
	mov bl,7
	jmp end_check

check8:
	cmp bx, 48h	    ; if click on rightarrow (index 3 in array kbdbuf)
	jne end_check
	mov bl,6
	jmp end_check
	
end_check:
    push cx
	mov cx, 7
    shr al, cl              ; al = 0 if pressed, 1 if released
	pop cx
    xor al, 1               ; al = 1 if pressed, 0 if released
    mov     [cs:kbdbuf+bx], al  ; save pressed buttons in array kbdbuf
	
	
                                ; send EOI to XT keyboard
    in      al, 61h
    mov     ah, al
    or      al, 80h
    out     61h, al
    mov     al, ah
    out     61h, al

                                ; send EOI to master PIC
    mov     al, 20h
    out     20h, al
	
    pop     si
    pop     di                       
    pop     dx
    pop     cx
    pop     bx
    pop     ax
   
    iret
endp my_isr

proc print_backgroungf
    push bp
    mov bp, sp
    push ax
    push bx
    push cx
    push dx
    push si
;-----------black_box----------------
    mov bx, [bp+4]      ;the backgroungf adress
    mov si, [bp+6]
    mov cx, 20      ;the image width
    next_color3:


        push cx
        push bx
        mov cx, 15
        draw_pixel3:
            mov ah, [si]

            mov [es:bx], ah 
            inc bx
            inc si
            loop draw_pixel3
        pop bx
        pop cx
        add bx, 320
        loop next_color3


;-----------black_box----------------
    pop si
    pop dx
    pop cx
    pop bx
    pop ax
    pop bp
    ret 4
endp print_backgroungf

proc print_backgroundw
push bp
mov bp,sp
push di
push si
push cx
push ax
;-----------black_box----------------
    mov di, [bp+4]      ;the backgroundw adress on screen
    mov si, [bp+6]
    mov cx, 20      ;the image width
    next_color6:


        push cx
        push di
        mov cx, 15
        draw_pixel6:
            mov ah, [si]
            mov [es:di], ah  
            inc di
            inc si
            loop draw_pixel6
        pop di
        pop cx
        add di, 320
        loop next_color6

;-----------black_box----------------
pop ax
pop cx
pop si
pop di
pop bp
ret 4
endp print_backgroundw

proc print_backgroundc
push bp
mov bp,sp
push di
push si
push cx
push ax
;-----------black_box----------------
    mov di, [bp+4]      ;the backgroundw adress
    mov si, [bp+6]
    mov cx, 21      ;the image width
    next_color12:


        push cx
        push di
        mov cx, 21
        draw_pixel12:
            mov ah, [si]
            mov [es:di], ah  
            inc di
            inc si
            loop draw_pixel12
        pop di
        pop cx
        add di, 320
        loop next_color12

;-----------black_box----------------
pop ax
pop cx
pop si
pop di
pop bp
ret 4
endp print_backgroundc

proc print_fireboy
    push bp
    mov bp, sp
    push ax
    push bx
    push cx
    push dx
    push si
;-----------black_box----------------
    mov bx, [bp+4]      ;the fireboy adress
    mov si, [bp+6]
    mov cx, 20      ;the image lenght
    next_color8:
        push cx
        push bx
        mov cx, 15
        draw_pixel8:
            mov ah, [si]                 ;offset fireboy
            cmp ah, 253
            je next_pixel8
            mov [es:bx], ah  
            next_pixel8:
            inc bx
            inc si
            loop draw_pixel8
        pop bx
        pop cx
        add bx, 320
        loop next_color8
;-----------black_box----------------
    pop si
    pop dx
    pop cx
    pop bx
    pop ax
    pop bp
    ret 4
endp print_fireboy

proc print_level
    push bp
    mov bp, sp
    push ax
    push di
    push cx
    push dx
    push si
;-----------black_box----------------
    mov di, [bp+4]      ;the level adress on the screen
    mov si, [bp+6]      ;offset level
    mov cx, 8        ;the image width
    next_color15:
        push cx
        push di
        mov cx, 35    ;image length 
        draw_pixel15:
            mov ah, [si]
            mov [es:di], ah  
            inc di
            inc si
            loop draw_pixel15
        pop di
        pop cx
        add di, 320
        loop next_color15
;-----------black_box----------------
    pop si
    pop dx
    pop cx
    pop di
    pop ax
    pop bp
    ret 4
endp print_level

proc print_watergirl
    push bp
    mov bp, sp
    push ax
    push di
    push cx
    push dx
    push si
;-----------black_box----------------
    mov di, [bp+4]      ;the watergirl adress
    mov si, [bp+6]
    mov cx, 20        ;the image width
    next_color4:


        push cx
        push di
        mov cx, 15      ;image length 
        draw_pixel4:
            mov ah, [si]
            cmp ah, 253
            je next_pixel4
            mov [es:di], ah  
            next_pixel4:
            inc di
            inc si
            loop draw_pixel4
        pop di
        pop cx
        add di, 320
        loop next_color4


;-----------black_box----------------
    pop si
    pop dx
    pop cx
    pop di
    pop ax
    pop bp
    ret 4
endp print_watergirl

proc print_doors
    push bp
    mov bp, sp
    push ax
    push di
    push cx
    push dx
    push si
;-----------black_box----------------
    mov di, [bp+4]      ;the door adress on the screen
    mov si, [bp+6]      ;offset reddoor/bluedoor
    mov cx, 25        ;the image width
    next_color13:


        push cx
        push di
        mov cx, 22      ;image length 
        draw_pixel13:
            mov ah, [si]
            cmp ah, 253
            je next_pixel13
            mov [es:di], ah  
            next_pixel13:
            inc di
            inc si
            loop draw_pixel13
        pop di
        pop cx
        add di, 320
        loop next_color13


;-----------black_box----------------
    pop si
    pop dx
    pop cx
    pop di
    pop ax
    pop bp
ret 4
endp print_doors

proc print_cube
    push bp
    mov bp, sp
    push ax
    push di
    push cx
    push dx
    push si
;-----------black_box----------------
    mov di, [bp+4]      ;the cube adress
    mov si, [bp+6]
    mov cx, 21        ;the image width
    next_color10:


        push cx
        push di
        mov cx, 21      ;image length 
        draw_pixel10:
            mov ah, [si]
            cmp ah, 253
            je next_pixel10
            mov [es:di], ah  
            next_pixel10:
            inc di
            inc si
            loop draw_pixel10
        pop di
        pop cx
        add di, 320
        loop next_color10

;-----------black_box----------------
    pop si
    pop dx
    pop cx
    pop di
    pop ax
    pop bp
ret 4
endp print_cube

proc printdimond
push bp
mov bp, sp
push ax
push di
push cx
push dx
push si
;-----------black_box----------------
    mov di, [bp+4]      ;the bluedimond adress/reddimond adress on the screen
    mov si, [bp+6]
    mov cx, 15      ;the image width
    next_color5:


        push cx
        push di
        mov cx, 15      ;image length 
        draw_pixel5:
            mov ah, [si]
            cmp ah, 253
            je next_pixel5
            mov [es:di], ah  
            next_pixel5:
            inc di
            inc si
            loop draw_pixel5
        pop di
        pop cx
        add di, 320
        loop next_color5


;-----------black_box----------------
pop si
pop dx
pop cx
pop di
pop ax
pop bp
ret 4
endp printdimond

proc OpenFilemap
; Open file
mov ah, 3Dh
xor al, al
mov dx, offset map
int 21h
jc openerror1
mov [filehandle], ax
ret
openerror1 :
mov dx, offset ErrorMsg
mov ah, 9h
int 21h
ret
endp OpenFilemap

proc OpenFilevictory
mov ah, 3Dh
xor al, al
mov dx, offset victoryp
int 21h
jc openerror2
mov [filehandle], ax
ret
openerror2 :
mov dx, offset ErrorMsg
mov ah, 9h
int 21h
ret
endp OpenFilevictory

proc borders
push bp
mov bp,sp
push bx
push si
push ax
push dx
push cx
push di
;-----------black_box----------------
mov si,[bp+4]                        ;si value of key press
mov bx,[bp+6]                        ;fireboy   bx                   
    cmp si,7
    je right
    cmp si,3
    je right
    cmp si,6
    je up
    cmp si,2
    je up
    cmp si,5
    je left
    cmp si,1
    jne down
left: 
    dec bx
    mov cx,20
    next:
    mov ah,[es:bx]
    cmp ah,91
    je updatel
    cmp ah,246
    je updatel
    add bx,320
    loop next
    jmp outtb
up:
    sub bx,320
    mov cx,15
    nex1:
    mov ah,[es:bx]
    cmp ah,91
    je updateu
    mov ah,[es:bx]
    cmp ah,246
    je updateu
    inc bx
    loop nex1
    jmp outtb
right:
    add bx,15
    mov cx,20
    inc bx
    next2:
    mov ah,[es:bx]
    cmp ah,91
    je updater
    cmp ah,246
    je updater
    add bx,320
    loop next2
    jmp outtb
down:
    add bx,(320*20)+2
    mov cx,10
    next5:
    mov ah,[es:bx]
    cmp ah,91
    je updated
    cmp ah,246
    je updated
    inc bx
    loop next5
    jmp outtb
updated:
mov al,'d'
jmp outtb
updater:
mov al,'r'
jmp outtb
updateu:
mov al,'u'
jmp outtb
updatel:
mov al,'l'
outtb:
mov [bp+6],ax
;-----------black_box----------------
pop di
pop cx
pop dx
pop ax
pop si
pop bx
pop bp
ret 2
endp borders

proc savebackgounds
    push offset backgroundf
	push (320*178)+10
	call backgroundf1
	push offset backgroundw
    push (320*150)+10
    call backgroundw1
    push offset backgrounddf1
    push (320*178)+163
    call backgroundd
    push offset backgrounddw1
    push (320*178)+230
    call backgroundd
    push offset backgrounddf2
    push (320*85)+60  
    call backgroundd
    push offset backgrounddw2
    push (320*93)+185 
    call backgroundd
    push offset backgrounddw3
    push (320*31)+10 
    call backgroundd
    push offset backgrounddf3
    push (320*10)+90  
    call backgroundd
    push offset backgrounddf4
    push (320*25)+150  
    call backgroundd
    push offset backgrounddw4
    push (320*25)+180  
    call backgroundd
    push offset backgroundl1
    push (320*83)+281
    call backgroundl
ret
endp savebackgounds


;=====================================================================
;   Start code
;=====================================================================
;
start:
  	mov ax, @data                    ; start address of segment data
	mov ds, ax
	mov ax, 0a000h            
	mov es,ax                        
	mov ax, 13h
	int 10h
    menu1:
    call openfilemenu
    call ReadHeader
    call ReadPalette
    push offset palette
    call CopyPal
    call CopyBitmap
    ;Wait for key press
    mov ah,1
    int 21h
    cmp al,1bh
    je exit
    cmp al,0dh
    jne menu1
    call closefile
    wait1:
    call OpenFile
    call ReadHeader
    call ReadPalette
    push offset palette
    call CopyPal
    call CopyBitmap
    ;Wait for key press
    mov ah,1
    int 21h
    cmp al,0dh
    jne wait1
    call closefile
continue:
    ;push [byte ptr map]
    call OpenFilemap
    call ReadHeader
    call ReadPalette
    push offset palette
    call CopyPal
    call CopyBitmap
    call closefile
	;push offset fireboy
	;call blackscreen
    call savebackgounds
    push ax
	call change_handler              ; put my own keyboard interrupt
    pop ax
    cmp ax,'v'
    je menu1
    cmp ax,0
    je exit
    call OpenFilegameover
    call ReadHeader
    call ReadPalette
    push offset palette
    call CopyPal
    call CopyBitmap
    call closefile
    jmp menu1
exit:
	mov ah, 0
	mov al, 2
	int 10h
	mov ax, 4c00h
	int 21h
END start
